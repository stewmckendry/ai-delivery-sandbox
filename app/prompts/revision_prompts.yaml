input_snapshot:
  system: "You are a policy assistant summarizing session inputs for document drafting."
  user: |
    Review the following inputs that were uploaded or generated during this policy drafting session. Create a structured summary that categorizes the inputs by type and describes their content.

    Inputs:
    ===
    {{ inputs }}

    === Instructions ===
    - Organize by input type (e.g., research notes, file uploads, links, etc.).
    - Summarize the intent and useful content of each input.
    - Keep the language clear and factual.
    - Be concise and informative.

feedback_structuring:
  system: "You are a helpful assistant for structuring policy document feedback."
  user: |
    You will help structure user feedback for a government policy artifact.

    Below is a batch of raw feedback entries. Some may reference a section explicitly, others may be general or ambiguous.
    ---
    {{ feedback_entries }}
    ---

    Please:
    1. Normalize tone and phrasing.
    2. If multiple requests are embedded, split them into separate items.
    3. Assign each feedback item to the most likely section ID based on references or semantic match. If no clear match, best-guess from summaries.
    4. Infer the required revision type from this set: rewrite, polish, append, clarify, targeted_edit, unspecified.

    Sections:
    {% for s in sections %}
    - ID: {{s.section_id}}\nSummary: {{s.text}}
    {% endfor %}

    Respond in JSON format, e.g.:
    {
      "section_feedback_map": {
        "sec-001": [
          {"text": "Please clarify the policy timeline.", "type": "clarify"},
          {"text": "Add a comparison to international models.", "type": "append"}
        ],
        "sec-002": [
          {"text": "Tone is too informal—refine wording.", "type": "polish"}
        ],
        "general": [
          {"text": "Make sure all metrics are evidence-based.", "type": "rewrite"}
        ]
      }
    }


feedback_mapping:
  system: "You help map feedback to document revisions."
  user: |
    You are a policy document editor. A user has submitted feedback on a public sector program artifact.

    Analyze the following feedback and return:
    - A list of section IDs affected (if specified, prioritize that section)
    - The type of revision required: rewrite, polish, append, clarify, or targeted_edit

    Feedback:
    ---
    {{feedback_text}}
    ---

    Sections:
    {% for s in sections %}
    - ID: {{s.section_id}}\nSummary: {{s.text}}
    {% endfor %}

    Respond in JSON format:
    {
      "section_ids": [...],
      "revision_type": "..."
    }

section_rewrite:
  rewrite: |
    You are a policy analyst revising a government document section from scratch.
    Use the feedback below to improve clarity, alignment, and quality — while retaining the original section’s depth, structure, and substance.
    
    - Do not overly summarize or shorten the section.
    - Retain all relevant factual details unless specifically contradicted by the feedback.
    - Preserve the logical flow, formatting, and tone appropriate for a formal government document.

    Feedback: "{{feedback}}"
    Original Text:
    {{current_text}}

    Expected Output: Revised section text only. Do not include explanations.

  polish: |
    You are editing a government document for style, tone, and polish.
    Enhance the section’s fluency and precision without changing meaning or removing content.

    - Avoid reducing the length or content depth.
    - Keep the original structure, logic, and detail intact.

    Feedback: "{{feedback}}"
    Original Text:
    {{current_text}}

    Expected Output: Revised section text only. Do not include explanations.

  append: |
    Add content to address the feedback below, without removing or changing existing points.
    
    - Insert new material only where needed to address the feedback.
    - Do not shorten or alter existing ideas unless explicitly instructed.

    Feedback: "{{feedback}}"
    Original Text:
    {{current_text}}

    Expected Output: Revised section text only. Do not include explanations.

  clarify: |
    Improve clarity and precision based on this feedback.

    - Do not remove or simplify existing content unless necessary for clarity.
    - Retain the full length, structure, and factual richness of the original.

    Feedback: "{{feedback}}"
    Original Text:
    {{current_text}}

    Expected Output: Revised section text only. Do not include explanations.

  targeted_edit: |
    Apply focused revisions to address the specific change(s) described in the feedback.
    
    - Only revise the part(s) of the section directly affected.
    - Leave all other text unchanged in wording, structure, and depth.
    - Avoid introducing unrelated edits or general simplifications.

    Feedback: "{{feedback}}"
    Original Text:
    {{current_text}}

    Expected Output: Revised section text only. Do not include explanations.

revision_check:
  system: "You evaluate whether an edit followed its instruction."
  user: |
    Instruction: {{revision_type}}
    Original Text:
    {{original_text}}

    Revised Text:
    {{revised_text}}

    Did the edit respect the instruction? Reply YES or NO and explain briefly.

feedback_preprocess:
  system: "You help clean and structure messy or multi-part user feedback."
  user: |
    Analyze the following user feedback:
    ---
    {{feedback_text}}
    ---

    1. Normalize tone and phrasing.
    2. If multiple requests are included, split them.
    3. Identify the dominant revision intent.

    Respond in JSON format:
    {
      "cleaned_text": "...",
      "split_feedback": [...],
      "inferred_type": "rewrite | polish | append | clarify | targeted_edit | unspecified"
    }

diff_summary:
  system: "You are a policy analyst summarizing revisions to a document section."
  user: |
    Summarize the key differences between the original and revised versions of this section.

    Original:
    ---
    {{ original }}

    Revised:
    ---
    {{ revised }}

    === Instructions ===
    - Describe the key changes, additions, or removals.
    - Mention any structural, tone, or content shifts.
    - Be clear and concise (1 paragraph).
    - Avoid repetition or quoting full passages.
