## WP7 Design Plan: Project Profile Engine

### üîÑ Objective
Create a dynamic `ProjectProfile` engine that:
- Stores project-level configuration
- Syncs with toolchains and DB
- Injects project context into planning, generation, and validation

---

### üìä Scope & Components

#### üí° New DB Table: `ProjectProfile`
| Field | Type | Description |
|-------|------|-------------|
| project_id | TEXT (PK) | Unique project key |
| title | TEXT | User-provided project title |
| sponsor | TEXT | Department or agency lead |
| project_type | TEXT | Type (e.g., transit, broadband) |
| total_budget | NUMERIC | Optional cost info |
| start_date | DATE | Program start |
| end_date | DATE | End or projected completion |
| strategic_alignment | TEXT | Freeform policy alignment note |
| current_gate | INT | For toolchain routing |
| scope_summary | TEXT | Description of program boundaries |
| key_stakeholders | TEXT | List of stakeholders or partners (JSON string) |
| major_risks | TEXT | Known risks or concerns |
| resource_summary | TEXT | Summary of team, tools, or external support |
| last_updated | TIMESTAMP | Autogenerated |

- Fields are static for now but designed to be extensible
- Schema versioning or dynamic fields (e.g. JSONB) can be added later if needed
- Relationships between fields (e.g., strategic_alignment <-> stakeholders) may be added via lightweight linking logic, but not full ontology at this stage

#### üîπ Toolchain Injection Points
- `GenerateSectionChain.run()`
  - Inject `project_profile` into memory bundle
- `AssembleArtifactChain.run()`
  - Include title and budget in PDF header
- `planner_orchestrator.py`
  - Auto-load `ProjectProfile` for each session

#### üîπ Storage Logic
- `memory_sync.py`
  - Add `save_project_profile()` and `load_project_profile()`
  - Inject during planner boot and section save

#### üîπ Drive Routing Enhancements
- Update `storeToDrive.py` to optionally include `project_id` in subfolder tree
  - New format: `PolicyGPT/<project_id>/gate_<gate_id>/<artifact_id>/`

---

### üßë‚Äçüíº UX Design: Profile in User Journey
- Project profile initialized during input ingestion (text, file, link)
- Human confirms profile fields or edits via Canvas or GPT prompt
- Profile info reused across drafting sessions automatically
- Feedback flows update profile (e.g., stakeholder revision triggers update)

---

### üß™ Technical Design
- Project ID is extracted or assigned during `uploadTextInput` / `uploadFileInput` / `uploadLinkInput`
- New toolchain: `IngestInputChain.run()`
  - Extracts project metadata
  - Calls `save_project_profile()`
- Profile cached per session and injected across all GPT tasks
- Future extensibility via JSON field for arbitrary metadata
- Cross-reference: Add `project_id` as FK to all tables (`ArtifactSection`, `ReasoningTrace`, etc.)

---

### ‚öñÔ∏è Assumptions
- One `ProjectProfile` per project_id (many artifacts)
- `project_id` inferred from artifact metadata or session context
- Human provides at least minimal config via new input ingestion chain

---

### üöß Risks + Mitigations
- Drive folder schema changes must be backward compatible  
  ‚Üí Mitigation: versioned folder path fallback logic
- Circular dependencies between profile + planner injection  
  ‚Üí Mitigation: enforce read-only project_profile on planner init; never require it to plan
- Session routing errors if `project_id` is missing  
  ‚Üí Mitigation: fallback to auto-assigned UUID with warning + prompt for confirm

---

### üìñ Outputs
- Code: `project_profile_engine.py` (store, load, validate)
- Migration: Patch for new table
- Patch: `storeToDrive.py`, `memory_sync.py`, `generate_section_chain.py`, `assemble_artifact_chain.py`
- Docs: YAML schema + usage notes